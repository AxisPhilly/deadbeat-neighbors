<!DOCTYPE html>
<html lang="en">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>PlanPhilly - Delinquency Project</title>
    <link rel="stylesheet" href="css/foundation.min.css" type="text/css">
    <link rel="stylesheet" href="css/smoothness/jquery-ui-1.10.0.custom.min.css" type="text/css">
    <link rel="stylesheet" href="css/app.css" type="text/css">
  </head>
    <body>
      <header class="row">
        <div class="twelve columns">
          <h1>Tax-delinquent property impact</h1>
        </div>
      </header>

      <section class="info row">
        <div id="map-container" class="six columns">
          <div id="map"></div>
          <div id="legend"></div>
        </div>

        <div id="dashboard" class="six columns">
          <p>
            There are approximately 90,000 tax delinquent properties in Philadelphia.
            These properties reduce the overall value of other properties, even if those
            properties are not tax delinquent. This is called the "diminished value". 
          </p>
          <p>
            <i>
              Hover over the map to see the effect of tax delinquent properties on the neighborhood level.
              Search for your property in the box below to see the impact of tax delinquent properties on your own property.
              Note: If your property is not found, it couldn't be included in the analysis--but it may still be impacted.
            </i>
          </p>
          <p>
            <label>Search for a property (ex: 1000 S Chadwick or 247 S St Bernard):<input id="lookup" type="text"></input></label>
          </p>
          <div id="results">

          </div>
        </div>
      </section>

      <footer class="row">
        <div class="twelve columns">
          <hr>
          <p>
            <cite>
              Reporting by Patrick Kerkstra. Application by <a href="http://www.axisphilly.org/author/casey">Casey Thomas</a>. Analysis by Kevin Gillen.
              <a href="http://www.azavea.com/about-us/giving-back/azavea-commons/">Philadelphia Neighborhoods Polygons</a>: Azavea Incorporated, licensed under the <a href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 United States License</a>.
            </cite>
          </p>
        </div>
      </footer>
      <script type="text/javascript" src="js/d3.min.js"></script>
      <script type="text/javascript" src="js/topojson.js"></script>
      <script type="text/javascript" src="js/app.js"></script>
      <script type="text/javascript" src="http://localhost:3000/nowjs/now.js"></script>
      <script type="text/javascript" src="js/jquery-1.9.0.min.js"></script>
      <script type="text/javascript" src="js/jquery-ui-1.10.0.custom.min.js"></script>
      <script type="text/javascript">
        $(document).ready(function(){
          app.run();
          app.results = [];
          app.currentAddress = '';

          $("#lookup").autocomplete({
            source: function(request, response){ 
              now.search(request, 10, function(err, results) {
                var props = [];
                app.results = results;
                
                for(var i=0; i<results.length; i++) {
                  props.push(results[i].address);
                }

                response(props);
              });
            },
            minLength: 4
          });

          $("#lookup").on("autocompleteselect", function(event, ui) {
            for(var i=0; i<app.results.length; i++) {
              if(app.results[i].address === this.value) {
                var data = app.results[i],
                    percent = (data.dimPercent * 100).toFixed(1).replace('-','')
                    html = 'There are approximately <strong>' + data.count + '</strong> tax delinquent properties' +
                           ' near <strong>' + data.address + '</strong>,' + 
                           ' which diminish the value of the property by <strong>' + percent + '%</strong>.';

                app.currentAddress = data.address;
                $("#results").html(html);
              }
            }
          });

          $("#lookup").on("keyup", function(event, ui){
            if(event.which === 8 && this.value !== app.currentAddress) {
              $("#results").html('');
            }
          });
        });
      </script>
  </body>
</html>